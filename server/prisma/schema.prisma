generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
}

enum Role {
  DOCTOR
  ADMIN
  RECEPTIONIST
  PHARMACIST
  INVENTORY_MANAGER
  CO_ADMIN
  OTHER
}

enum MedType {
  TABLET
  SYRUP
}

enum Sex {
  m
  f
  o
}

enum Days {
  MON
  TUE
  WED
  THU
  FRI
  SAT
  SUN
}

enum Category {
  GENERAL_MEDICINE
  CARDIOLOGY
  DERMATOLOGY
  INTERNAL_MEDICINE
  OPHTHALMOLOGY
  ENT
  GYNAECOLOGY
}

enum Dosage {
  OD
  BD
  TD
  QD
  OW
  BW
  TW
  QW
}

model Auth {
  id       Int    @id @default(sequence())
  name     String
  email    String @unique
  password String
}

model Profile {
  authId         Int           @id
  designation    String?
  contact        String?
  address        String?
  bio            String?
  sex            Sex
  availability   String[] // time range
  available_days Days[]
  room_number    Int?
  authority_name String?
  category       Category?
  origin         String?       @default("JMI")
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now())
  Appointment    Appointment[]
}

model Patient {
  id          Int           @id @default(sequence())
  name        String
  age         Int
  sex         Sex
  lastVisit   String?
  contact     String        @unique
  address     String?
  email       String?
  jamiaId     String?
  Appointment Appointment[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(now())
}

model Appointment {
  id           Int            @id @default(sequence())
  date         DateTime       @default(now())
  Prescription Prescription[]
  patientId    Int
  patient      Patient        @relation(fields: [patientId], references: [id])
  doctorId     Int
  doctor       Profile        @relation(fields: [doctorId], references: [authId])
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @default(now())
}

model Prescription {
  id              Int                  @id @default(sequence())
  symptoms        String
  diagnosis       String? // prescription
  CustomMedicines String
  datePrescribed  DateTime             @default(now())
  appointmentId   Int
  appointment     Appointment          @relation(fields: [appointmentId], references: [id])
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @default(now())
  medicines       PrescribedMedicine[]
}

model PrescribedMedicine {
  id              Int           @id @default(sequence())
  duration        Int
  dosage          Dosage?
  quantityPerDose String? // only for  syrups
  description     String
  MedicineId      Int
  Medicine        Medicine      @relation(fields: [MedicineId], references: [id])
  Prescription    Prescription? @relation(fields: [prescriptionId], references: [id])
  prescriptionId  Int?
}

// Store module start

model Medicine {
  id                 Int                  @id @default(sequence())
  name               String
  quantity           Int
  batchNumber        String
  expiry_date        String
  category           Category
  medType            MedType
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now())
  PrescribedMedicine PrescribedMedicine[]
}

model NonMedicine {
  id          Int      @id @default(sequence())
  name        String
  quantity    Int
  batchNumber String
  expiry_date String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
}

model OtherAssets {
  id        Int      @id @default(sequence())
  name      String
  quantity  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

// Store module end
